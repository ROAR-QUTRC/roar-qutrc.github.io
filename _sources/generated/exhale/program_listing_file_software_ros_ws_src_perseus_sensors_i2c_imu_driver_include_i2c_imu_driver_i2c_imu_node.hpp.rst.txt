
.. highlight:: none




.. _program_listing_file_software_ros_ws_src_perseus_sensors_i2c_imu_driver_include_i2c_imu_driver_i2c_imu_node.hpp:

Program Listing for File i2c_imu_node.hpp
=========================================

|exhale_lsh| :ref:`Return to documentation for file <file_software_ros_ws_src_perseus_sensors_i2c_imu_driver_include_i2c_imu_driver_i2c_imu_node.hpp>` (``software/ros_ws/src/perseus_sensors/i2c_imu_driver/include/i2c_imu_driver/i2c_imu_node.hpp``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   #pragma once
   
   #include <atomic>
   #include <chrono>
   #include <memory>
   #include <rclcpp/rclcpp.hpp>
   #include <sensor_msgs/msg/imu.hpp>
   #include <string>
   
   #include "i2c_imu_driver/i2c_device.hpp"
   #include "i2c_imu_driver/imu_data_types.hpp"
   #include "i2c_imu_driver/imu_device_config.hpp"
   
   namespace i2c_imu_driver
   {
   
       class I2cImuNode : public rclcpp::Node
       {
       public:
           explicit I2cImuNode(const rclcpp::NodeOptions& options = rclcpp::NodeOptions());
   
           ~I2cImuNode();
   
       private:
           void _initialize_parameters();
   
           void _initialize_publishers();
   
           bool _initialize_device();
   
           void _timer_callback();
   
           ImuData _read_sensor_data();
   
           sensor_msgs::msg::Imu _convert_to_ros_message(const ImuData& imu_data);
   
           bool _initialize_sensor();
   
           // Node parameters
           std::string _i2c_bus_path;
           uint8_t _device_address;
           double _update_rate;
           std::string _frame_id;
           bool _required;
           int _retry_count;
   
           // Device configuration
           std::string _device_type;
           const ImuDeviceConfig* _device_config;
   
           // IMU calibration parameters
           double _accel_scale_x{1.0};
           double _accel_scale_y{1.0};
           double _accel_scale_z{1.0};
           double _accel_offset_x{0.0};
           double _accel_offset_y{0.0};
           double _accel_offset_z{0.0};
   
           double _gyro_scale_x{1.0};
           double _gyro_scale_y{1.0};
           double _gyro_scale_z{1.0};
           double _gyro_offset_x{0.0};
           double _gyro_offset_y{0.0};
           double _gyro_offset_z{0.0};
   
           // Covariance matrices (orientation not estimated by IMU)
           std::array<double, 9> _angular_velocity_covariance;
           std::array<double, 9> _linear_acceleration_covariance;
   
           // ROS2 components
           std::unique_ptr<I2cDevice> _i2c_device;
           rclcpp::Publisher<sensor_msgs::msg::Imu>::SharedPtr _imu_publisher;
           rclcpp::TimerBase::SharedPtr _timer;
   
           // Status tracking
           std::atomic<bool> _device_initialized{false};
           size_t _sequence_number{0};
       };
   
   }  // namespace i2c_imu_driver
